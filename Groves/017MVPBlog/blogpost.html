<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.5.dev">
<title>Couchbase with Windows and .NET</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
body{-webkit-font-smoothing:antialiased}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
body{tab-size:4}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
</head>
<body class="article">
<div id="header">
<h1>Couchbase with Windows and .NET</h1>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>We&#8217;re going to look at the basics of interacting with Couchbase for .NET developers on Windows. We&#8217;ll start with the basics, and build towards a "vertical" slice of a complete ASP.NET MVC app on the .NET 4.x framework. For a deeper dive, please check out <a href="http://blog.couchbase.com/">my blog posts on Couchbase</a> and the <a href="http://developer.couchbase.com">Couchbase Developer Portal</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="trueinstalling-couchbase-server"><a class="anchor" href="#trueinstalling-couchbase-server"></a>Installing Couchbase Server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Let&#8217;s start with the easiest part:</p>
</div>
<div class="sect3">
<h4 id="true-a-href-http-www-couchbase-com-nosql-databases-downloads-download-and-install-couchbase-server-a"><a class="anchor" href="#true-a-href-http-www-couchbase-com-nosql-databases-downloads-download-and-install-couchbase-server-a"></a><a href="http://www.couchbase.com/nosql-databases/downloads">Download and install Couchbase Server</a>.</h4>
<div class="paragraph">
<p>Windows 10, Mac OS X and Linux packages are all available. Go to the <a href="http://www.couchbase.com/nosql-databases/downloads">Downloads page on the Couchbase website</a>. We&#8217;ll use the Enterprise Edition for this blog post. Let&#8217;s proceed with a Windows 10 installation.</p>
</div>
<div class="paragraph">
<p>Run the downloaded installation file, and go through a 4-step wizard.</p>
</div>
<div class="paragraph">
<p>At this point, Couchbase should be running as a Windows Service (verify by <a href="https://technet.microsoft.com/en-us/library/cc755249.aspx">opening services.msc</a>).</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/CouchbaseServerWindowsService_006.png" alt="Couchbase Server in services.msc"></span></p>
</div>
<div class="paragraph">
<p>We&#8217;ll automatically be taken to the Couchbase Console via web browser to customize the Couchbase setup. We can always return to this console via <a href="http://localhost:8091">http://localhost:8091</a>.</p>
</div>
<div class="paragraph">
<p>Click "Setup" to start the configuration wizard. Let&#8217;s stick with the default settings (mostly) for now.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In step 1, we need to specify how much RAM to give to Couchbase. It might be a good idea to dial down some of the default RAM Quotas (we can always change them later). Since we only need the one node for development, let&#8217;s enabled all services on this node (Index, Query, and Full Text). I would recommend checking out some of the <a href="http://learn.couchbase.com/">free Couchbase training</a> available to dive deeper into tweaking these settings.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/CouchbaseServerWizard_008.png" alt="Couchbase Server Configuration Wizard"></span></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In step 2, we can choose to install some sample data. For this blog post, we don&#8217;t need to do this. However, the "travel-sample" is useful for trying out some of the N1QL functionality (more on that later).</p>
</li>
<li>
<p>In step 3, let&#8217;s create a "default" bucket, to follow along with this blog post.</p>
</li>
<li>
<p>In step 4, we can elect to receive notifications from Couchbase and register the product.</p>
</li>
<li>
<p>Finally, in step 5, we need to enter a username and password to create an administrator account.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Now we&#8217;re ready to start using Couchbase. On the "overview" page, we can see how much RAM is available to Couchbase, and how much is actually in use. If we wanted to scale out Couchbase by adding servers, then we would see them listed in the Servers section. If we click on the "Data Buckets" tab, we&#8217;ll see that there&#8217;s at least the default bucket we created.</p>
</div>
<div class="paragraph">
<p>Feel free to play around with the Couchbase Console and check out the <a href="http://developer.couchbase.com/documentation/server/4.5/admin/ui-intro.html">Couchbase Console documentation</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="truesome-nosql-lingo"><a class="anchor" href="#truesome-nosql-lingo"></a>Some NoSQL lingo</h2>
<div class="sectionbody">
<div class="paragraph">
<p>But before we dive into some code, let&#8217;s go over some of the lingo with Couchbase. It&#8217;s not a difficult tool to use, but it is different from RDBMS systems like SQL Server.</p>
</div>
<div class="paragraph">
<p><strong>Node</strong></p>
</div>
<div class="paragraph">
<p>A node is an invidual machine that is running Couchbase Server.</p>
</div>
<div class="paragraph">
<p><strong>Cluster</strong></p>
</div>
<div class="paragraph">
<p>Nodes are joined together into a <a href="http://developer.couchbase.com/documentation/server/current/clustersetup/manage-cluster-intro.html">cluster</a> that act in concert to provide scaling and improved availability. Scaling: more nodes means more RAM and disk space. Availability: if one node goes down, the cluster will continue to function. As developers, we don&#8217;t generally have to worry about node management and clustering in code: it&#8217;s all handled by Couchbase and the Couchbase .NET SDK.</p>
</div>
<div class="paragraph">
<p><strong>Bucket</strong></p>
</div>
<div class="paragraph">
<p>A <a href="http://developer.couchbase.com/documentation/server/4.5/clustersetup/bucket-setup.html">bucket</a> is a place to store documents. Each document has a key. Within a bucket, each key must be unique. Typically, a single bucket corresponds to a single application. The documents within a bucket do not have to be similar at all. We could store a document that contains information about a user, and a document with information about a building, both in the same bucket.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/CouchbaseBucket_003.png" alt="A bucket with two documents in it"></span></p>
</div>
<div class="paragraph">
<p><strong>Document</strong></p>
</div>
<div class="paragraph">
<p>In a basic sense, a Couchbase bucket is a giant <code>Dictionary&lt;string,string&gt;</code>. Each entry in a bucket consists of a key and a document. Documents consist of JSON. Because Couchbase uses JSON documents, it&#8217;s called a "document database".</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/CouchbaseDocument_004.png" alt="A JSON document"></span></p>
</div>
<div class="paragraph">
<p><strong>N1QL</strong></p>
</div>
<div class="paragraph">
<p>With Couchbase Server, we can write queries in a language called <a href="http://developer.couchbase.com/documentation/server/4.5/developer-guide/querying.html">N1QL</a> (N1QL stands for "Non-first Normal Form Query Language, pronounced "nickel"). N1QL is a superset of SQL. This means that, basically, if you know SQL, then you know N1QL. An example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-SQL" data-lang="SQL">SELECT name AS bookName, author AS bookAuthor
FROM `books-bucket`
WHERE YEAR(published) &gt;= 1998</code></pre>
</div>
</div>
<div class="paragraph">
<p>That will return something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript" data-lang="javascript">{
	"results": [
		{ "bookName" : "The Little Book of Calm", "bookAuthor" : "Manny Bianco" },
		{ "bookName" : "AOP in .NET", "bookAuthor" : "Matthew D. Groves" }
	]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As we&#8217;ll see later, the Linq2Couchbase library leverages N1QL into a LINQ provider that is similar to Entity Framework, NHibernate.Linq, etc.</p>
</div>
<div class="paragraph">
<p><strong>Indexes</strong></p>
</div>
<div class="paragraph">
<p><a href="http://developer.couchbase.com/documentation/server/4.5/indexes/n1ql-in-couchbase.html">Indexes</a> in Couchbase are as important as in relational databases. Probably more so, because buckets contain a variety of documents.</p>
</div>
<div class="paragraph">
<p>To enable N1QL queries on a bucket, we need to at least create a primary index. This is an index on the bucket itself. Here&#8217;s how to create one with N1QL: <code>CREATE PRIMARY INDEX ON `my-bucket`</code></p>
</div>
<div class="paragraph">
<p>We can create indexes based on the fields in the documents. For instance, if we have a lot of documents that have "name" or "author" fields, and we end up querying based on this fields often, we can create indexes for them. These are "secondary indexes." As the size of a bucket grows, so does the importance of indexing.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="trueasp-net-mvc"><a class="anchor" href="#trueasp-net-mvc"></a>ASP.NET MVC</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now that we&#8217;ve got some lingo out the way, let&#8217;s start a new ASP.NET MVC project, add the <a href="https://www.nuget.org/packages/CouchbaseNetClient/">Couchbase SDK to it with NuGet</a>, and get the infrastructure in place to start using Couchbase.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s start in Visual Studio with a File&#8594;New, and select ASP.NET Web Application, then select "MVC". I&#8217;m going to assume you have some familiarity with ASP.NET MVC (we&#8217;re using .NET 4.x, but a .NET Core Couchbase SDK is coming soon).</p>
</div>
<div class="sect2">
<h3 id="trueinstalling-the-couchbase-client-library"><a class="anchor" href="#trueinstalling-the-couchbase-client-library"></a>Installing the Couchbase client library</h3>
<div class="paragraph">
<p>The first thing we&#8217;ll need to do is add the Couchbase .NET client. We can do this with the NuGet UI by right-clicking on "References", clicking "Manage NuGet Packages", clicking "Browse", and then searching for "CouchbaseNetClient". (We could search for "Linq2Couchbase" instead. Installing that will also install CouchbaseNetClient, but we won&#8217;t actually be using Linq2Couchbase until later).</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/NuGetUI_001.png" alt="NuGet UI for installing CouchbaseNetClient"></span></p>
</div>
<div class="paragraph">
<p>If you prefer the NuGet command line, then open up the Package Manager Console, and type <code>Install-Package CouchbaseNetClient</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="truegetting-asp-net-to-talk-to-a-couchbase-cluster"><a class="anchor" href="#truegetting-asp-net-to-talk-to-a-couchbase-cluster"></a>Getting ASP.NET to talk to a Couchbase cluster</h3>
<div class="paragraph">
<p>Now let&#8217;s setup the ASP.NET app to be able to connect to Couchbase. The first thing we need to do is locate the Couchbase Cluster. The best place to do this is in the <code>Global.asax.cs</code> when the application starts. At a minimum, we need to specify one node in the cluster, and give that to the <code>ClusterHelper</code>. We only need this in <code>Application_Start</code>. When the application ends, it&#8217;s a good idea to close the <code>ClusterHelper</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C#" data-lang="C#">public class MvcApplication : System.Web.HttpApplication
{
    protected void Application_Start()
    {
        AreaRegistration.RegisterAllAreas();
        FilterConfig.RegisterGlobalFilters(GlobalFilters.Filters);
        RouteConfig.RegisterRoutes(RouteTable.Routes);

        var config = new ClientConfiguration();
        config.Servers = new List&lt;Uri&gt;
        {
            new Uri("http://localhost:8091")
        };
        config.UseSsl = false;
        ClusterHelper.Initialize(config);
    }

    protected void Application_End()
    {
        ClusterHelper.Close();
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="trueusing-the-code-ibucket-code-in-a-controller"><a class="anchor" href="#trueusing-the-code-ibucket-code-in-a-controller"></a>Using the <code>IBucket</code> in a controller</h3>
<div class="paragraph">
<p>Just to show that this works, go ahead and add IBucket to a constructor of a controller, say <code>TestController</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C#" data-lang="C#">public class TestController : Controller
{
    IBucket _bucket;

    public TestController()
    {
        _bucket = ClusterHelper.GetBucket("default");
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>(In the long run, we don&#8217;t want an IBucket directly in MVC controllers, more on that later).</p>
</div>
<div class="paragraph">
<p>Next, let&#8217;s add a document to the bucket, directly in Couchbase Console. Use anything for a key, but make a note of it.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/CouchbaseCreateDocument_003.png" alt="Specifying a key for a new document in Couchbase"></span></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/CouchbaseCreateDocument_004.png" alt="Creating a document in Couchbase"></span></p>
</div>
<div class="paragraph">
<p>Now, let&#8217;s add an action to <code>TestController</code>. It will get the document based on the key, and write the document values in the response.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C#" data-lang="C#">public ActionResult Index()
{
    var doc = _bucket.Get&lt;dynamic&gt;("foo::123");
    return Content("Name: " + doc.Value.name + ", Address: " + doc.Value.address);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>doc.Value</code> is of type <code>dynamic</code>, so make sure that the fields (in this case, "name" and "address") match up to the JSON document in the bucket. Run the MVC site in a browser, and we should see something like this:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/couchbaseaspnethelloworld_005b.png" alt="Outputting the document values to a browser"></span></p>
</div>
<div class="paragraph">
<p>Congratulations, we&#8217;ve successfully written an ASP.NET site that uses Couchbase!</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="trueintroducing-linq2couchbase"><a class="anchor" href="#trueintroducing-linq2couchbase"></a>Introducing Linq2Couchbase</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Let&#8217;s build on what we&#8217;ve already done by introducing <a href="https://github.com/couchbaselabs/Linq2Couchbase">Linq2Couchbase</a>. We&#8217;ll also move Couchbase out of the Controller and put it into a very basic <a href="http://www.martinfowler.com/eaaCatalog/repository.html">repository</a> class. My goal is to have you feeling comfortable with the basics of Couchbase and Linq2Couchbase, and be able to start applying it in a web application.</p>
</div>
<div class="sect2">
<h3 id="truemoving-couchbase-out-of-the-controller"><a class="anchor" href="#truemoving-couchbase-out-of-the-controller"></a>Moving Couchbase out of the Controller</h3>
<div class="paragraph">
<p>The Controller&#8217;s job is to direct traffic: take incoming requests, hand them to a model, and then give the results to the view. To follow the <a href="http://www.butunclebob.com/ArticleS.UncleBob.PrinciplesOfOod">SOLID principles</a> (specifically the Single Responsibility Principle), data access should be somewhere in a "model" and not the controller.</p>
</div>
<div class="paragraph">
<p>The first step is to refactor the existing code. We can keep the 'really simple example', but let&#8217;s move it to a method in another class. Here is the refactored HomeController and the new PersonRepository:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C#" data-lang="C#">public class HomeController : Controller
{
    private readonly PersonRepository _personRepo;

    public HomeController(PersonRepository personRepo)
    {
        _personRepo = personRepo;
    }

    public ActionResult Index()
    {
        var person = _personRepo.GetPersonByKey("foo::123");
        return Content("Name: " + person.name + ", Address: " + person.address);
    }
}

public class PersonRepository
{
    private readonly IBucket _bucket;

    public PersonRepository(IBucket bucket)
    {
        _bucket = bucket;
    }

    public dynamic GetPersonByKey(string key)
    {
        return _bucket.Get&lt;dynamic&gt;(key).Value;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, <code>HomeController</code> no longer depends directly on Couchbase.</p>
</div>
</div>
<div class="sect2">
<h3 id="truerefactoring-to-use-a-person-class"><a class="anchor" href="#truerefactoring-to-use-a-person-class"></a>Refactoring to use a Person class</h3>
<div class="paragraph">
<p>In the above example, we&#8217;re using a <code>dynamic</code> object. <code>dynamic</code> is great for some situations, but in this case, it would be a good idea to come up with a more concrete definition of what a "Person" is. We can do this with a C# class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C#" data-lang="C#">public class Person
{
    public string Name { get; set; }
    public string Address { get; set; }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We&#8217;ll also update the <code>PersonRepository</code> to use this class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C#" data-lang="C#">public Person GetPersonByKey(string key)
{
    return _bucket.Get&lt;Person&gt;(key).Value;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>While we&#8217;re at it, we&#8217;re going to take some steps to make this more of a proper MVC app. Instead of returning <code>Content()</code>, We&#8217;re going to make the Index action return a View, and we&#8217;re going to pass it a <strong>list</strong> of Person objects. We&#8217;ll create an <code>Index.cshtml</code> file, which will delegate to a partial of _person.cshtml. We&#8217;re also going to drop in a layout that uses Bootstrap. This last part is gratuitous, but it will make the app look nicer.</p>
</div>
<div class="paragraph">
<p>New Index action:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C#" data-lang="C#">public ActionResult Index()
{
    var person = _personRepo.GetPersonByKey("foo::123");
    var list = new List&lt;Person&gt; {person};
    return View(list);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Index.cshtml:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C#" data-lang="C#">@model List&lt;CouchbaseAspNetExample.Models.Person&gt;

@{
    ViewBag.Title = "Home : Couchbase &amp; ASP.NET Example";
}

@if (!Model.Any())
{
    &lt;p&gt;There are no people yet.&lt;/p&gt;
}

@foreach (var item in Model)
{
    @Html.Partial("_person", item)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>_person.cshtml:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C#" data-lang="C#">@model CouchbaseAspNetExample.Models.Person

&lt;div class="panel panel-default"&gt;
    &lt;div class="panel-heading"&gt;
        &lt;h2 class="panel-title"&gt;@Model.Name&lt;/h2&gt;
    &lt;/div&gt;
    &lt;div class="panel-body"&gt;
        @Html.Raw(Model.Address)
    &lt;/div&gt;
&lt;/div&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now it looks a little nicer. Additionally, we&#8217;ll be able to show a whole list of Person documents later in the demo.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/indexofcouchbasedocumentsinbootstrap_001.png" alt="The Index view of Couchbase Person documents in Bootstrap"></span></p>
</div>
</div>
<div class="sect2">
<h3 id="truelinq2couchbase"><a class="anchor" href="#truelinq2couchbase"></a>Linq2Couchbase</h3>
<div class="paragraph">
<p>Couchbase Server supports a query language known as <a href="http://www.couchbase.com/n1ql">N1QL</a>. It&#8217;s a superset of SQL, and allows us to leverage existing knowledge of SQL syntax to construct very powerful queries over JSON documents in Couchbase. Linq2Couchbase takes this a step further and converts LINQ queries into N1QL queries (much like Entity Framework converts LINQ queries into SQL queries).</p>
</div>
<div class="paragraph">
<p>Linq2Couchbase is part of <a href="https://github.com/couchbaselabs">Couchbase Labs</a>, and is not yet part of the core, supported Couchbase .NET SDK library. However, if you&#8217;re used to Entity Framework, NHibernate.Linq, or any other LINQ provider, it&#8217;s a great way to introduce yourself to Couchbase. For some operations, we will still need to use the core Couchbase .NET SDK, but there is a lot we can do with Linq2Couchbase.</p>
</div>
<div class="paragraph">
<p>Start by adding Linq2Couchbase with NuGet (if you haven&#8217;t already).</p>
</div>
<div class="paragraph">
<p>To use N1QL (and therefore Linq2Couchbase), <a href="http://developer.couchbase.com/documentation/server/4.5/n1ql/n1ql-language-reference/createprimaryindex.html">the bucket must be indexed</a>. Go into Couchbase Console, click the 'Query' tab, and create a primary index on the <code>default</code> bucket.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-SQL" data-lang="SQL">CREATE PRIMARY INDEX ON `default`;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we don&#8217;t have an index, Linq2Couchbase will throw a helpful error message like "No primary index on keyspace default. Use CREATE PRIMARY INDEX to create one."</p>
</div>
<div class="paragraph">
<p>In order to use Linq2Couchbase most effectively, we have to start giving Couchbase documents a "type" field. This way, we can differentiate between a "person" document and a "location" document. In this example, we&#8217;re only going to have "person" documents, but it&#8217;s a good idea to do this from the start. We&#8217;ll create a <code>Type</code> field, and set it to "Person". We&#8217;ll also put an attribute on the C# class so that Linq2Couchbase understands that this class corresponds to a certain document type.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C#" data-lang="C#">using Couchbase.Linq.Filters;

[DocumentTypeFilter("Person")]
public class Person
{
    public Person()
    {
        Type = "Person";
    }
    public string Type { get; set; }
    public string Name { get; set; }
    public string Address { get; set; }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>After we make these changes, the app will continue to work. This is because we are still retrieving the document by its key. But now let&#8217;s change the Index action to try and get ALL Person documents.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C#" data-lang="C#">public ActionResult Index()
{
    var list = _personRepo.GetAll();
    return View(list);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We&#8217;ll implement that new GetAll repository method using Linq2Couchbase:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C#" data-lang="C#">using System.Collections.Generic;
using System.Linq;
using Couchbase.Core;
using Couchbase.Linq;
using Couchbase.Linq.Extensions;
using Couchbase.N1QL;

public class PersonRepository
{
    private readonly IBucket _bucket;
    private readonly IBucketContext _context;

    public PersonRepository(IBucket bucket, IBucketContext context)
    {
        _bucket = bucket;
        _context = context;
    }

    public List&lt;Person&gt; GetAll()
    {
        return _context.Query&lt;Person&gt;()
           .ScanConsistency(ScanConsistency.RequestPlus)
           .OrderBy(p =&gt; p.Name)
           .ToList();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, we&#8217;re telling Couchbase to order all the results by Name. At this point, we can experiment with the normal LINQ methods: <code>Where</code>, <code>Select</code>, <code>Take</code>, <code>Skip</code>, and so on.</p>
</div>
<div class="paragraph">
<p>Just ignore that <code>ScanConsistency</code> for now: we&#8217;ll discuss it more later. But what about that <code>IBucketContext</code>? The <code>IBucketContext</code> is similar to <code>DbContext</code> for Entity Framework, or <code>ISession</code> for NHibernate. To get that <code>IBucketContext</code>, we&#8217;ll make some changes to <code>HomeController</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C#" data-lang="C#">public HomeController()
{
    var bucket = ClusterHelper.GetBucket("default");
    var bucketContext = new BucketContext(bucket);
    _personRepo = new PersonRepository(bucket, bucketContext);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We&#8217;re doing it this way for simplicity, but I recommend that you use a <a href="https://msdn.microsoft.com/en-us/library/ff921152.aspx">dependency injection</a> framework (like <a href="http://structuremap.github.io/">StructureMap</a>) to handle this, otherwise you&#8217;ll end up copy/pasting a lot of code into your Controllers.</p>
</div>
<div class="paragraph">
<p>Now, if we compile and run the web app again, it will display "There are no people yet". Hey, where did that person go?! It didn&#8217;t show up because the "foo::123" document doesn&#8217;t have a "type" field yet. Go to Couchbase Console and add it.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/UpdateCouchbaseDocument_003.png" alt="Adding a type field to a Couchbase document"></span></p>
</div>
<div class="paragraph">
<p>Once we do that and refresh the web page, the person will appear again.</p>
</div>
</div>
<div class="sect2">
<h3 id="truea-quick-note-about-scanconsistency"><a class="anchor" href="#truea-quick-note-about-scanconsistency"></a>A quick note about ScanConsistency</h3>
<div class="paragraph">
<p>Linq2Couchbase relies on an Index to generate and execute queries. Adding a new documents triggers an index update. Until the index finishes updating, any documents not yet indexed will not be returned by Linq2Couchbase (by default). By adding in <code>ScanConsistency</code> of <code>RequestPlus</code> (<a href="http://developer.couchbase.com/documentation/server/4.5/architecture/querying-data-with-n1ql.html">See Couchbase documentation for the details about scan consistency</a>), Linq2Couchbase will effectively wait until the index is updated before executing a query and returning a response. This is a tradeoff that you will have to think about when designing your application. Which is more important: raw speed or complete accuracy? The Couchbase SDK defaults to raw speed.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="truea-complete-asp-net-crud-implementation"><a class="anchor" href="#truea-complete-asp-net-crud-implementation"></a>A complete ASP.NET CRUD implementation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Let&#8217;s round out the sample app that we&#8217;ve been building with a full suite of CRUD functionality. The app already shows a list of people. We&#8217;ll next want to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add a new person via the web app (instead of directly in Couchbase Console)</p>
</li>
<li>
<p>Edit a person</p>
</li>
<li>
<p>Delete a person.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Before I start, a disclaimer. I&#8217;ve made some modeling <strong>decisions</strong> in this sample app. I&#8217;ve decided that keys to Person documents should be of the format "Person::{guid}", and I&#8217;ve decided that we will enforce the "Person::" prefix at the repository level. I&#8217;ve also made a decision not to use any intermediate view models or edit models in my MVC app, for the purposes of a concise demonstration. By no means do you have to make the same decisions I did! I encourage you to think through the implications for your particular use case, and I would be happy to discuss the merits and trade-offs of each approch in the comments or in the <a href="http://forums.couchbase.com">Couchbase Forums</a>.</p>
</div>
<div class="sect2">
<h3 id="trueadding-a-new-person-document"><a class="anchor" href="#trueadding-a-new-person-document"></a>Adding a new person document</h3>
<div class="paragraph">
<p>Up until now, we&#8217;ve used the Couchbase Console to create new documents. Now let&#8217;s make it possible via a standard HTML form on an ASP.NET page.</p>
</div>
<div class="paragraph">
<p>First, we need to make a slight change to the <code>Person</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C#" data-lang="C#">[DocumentTypeFilter("Person")]
public class Person
{
    public Person() { Type = "Person"; }

    [Key]
    public string Id { get; set; }
    public string Type { get; set; }
    public string Name { get; set; }
    public string Address { get; set; }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We added an <code>Id</code> field, and marked it with the <code>[Key]</code> attribute. This attribute comes from System.ComponentModel.DataAnnotations, but Linq2Couchbase interprets it to mean "use this field for the Couchbase key".</p>
</div>
<div class="paragraph">
<p>Now, let&#8217;s add a very simple new action to <code>HomeController</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C#" data-lang="C#">public ActionResult Add()
{
    return View("Edit", new Person());
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And We&#8217;ll link to that with the bootstrap navigation (which I snuck in previously, and by no means are you required to use):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-HTML" data-lang="HTML">&lt;ul class="nav navbar-nav"&gt;
    &lt;li&gt;&lt;a href="/"&gt;Home&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;@Html.ActionLink("Add Person", "Add", "Home")&lt;/li&gt;
&lt;/ul&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Nothing much out of the ordinary so far. We&#8217;ll create a simple <code>Edit.cshtml</code> with a straightforward, plain-looking form.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C#" data-lang="C#">@model CouchbaseAspNetExample3.Models.Person

@{
    ViewBag.Title = "Add : Couchbase &amp; ASP.NET Example";
}

@using (Html.BeginForm("Save", "Home", FormMethod.Post))
{
    &lt;p&gt;
        @Html.LabelFor(m =&gt; m.Name)
        @Html.TextBoxFor(m =&gt; m.Name)
    &lt;/p&gt;

    &lt;p&gt;
        @Html.LabelFor(m =&gt; m.Address)
        @Html.TextBoxFor(m =&gt; m.Address)
    &lt;/p&gt;

    &lt;input type="submit" value="Submit" /&gt;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since that form will be POSTing to a Save action, let&#8217;s create that next:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C#" data-lang="C#">[HttpPost]
public ActionResult Save(Person model)
{
    _personRepo.Save(model);
    return RedirectToAction("Index");
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that the <code>Person</code> type used in the parameter is the same type as before. Here is where a more complex web application would probably want to use an edit model, validation, mapping, and so on. I&#8217;ve omitted that, and I send the model straight to a new method in <code>PersonRepository</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C#" data-lang="C#">public void Save(Person person)
{
    // if there is no ID, then assume this is a "new" person
    // and assign an ID
    if (string.IsNullOrEmpty(person.Id))
        person.Id = "Person::" + Guid.NewGuid();

    _context.Save(person);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This repository method will set the <code>Id</code>, if one isn&#8217;t already set (it won&#8217;t be now, but it will be later, when we cover 'Edit'). The <code>Save</code> method on <code>IBucketContext</code> is from Linq2Couchbase. It will add a new document if the key doesn&#8217;t exist, or update an existing document if it does. It&#8217;s known as an <a href="http://developer.couchbase.com/documentation/server/current/n1ql/n1ql-language-reference/upsert.html">"upsert" operation</a>. In fact, we can do nearly the same thing without Linq2Couchbase:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C#" data-lang="C#">var doc = new Document&lt;Person&gt;
{
    Id = "Person::" + person.Id,
    Content = person
};
_bucket.Upsert(doc);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="trueediting-an-existing-person-document"><a class="anchor" href="#trueediting-an-existing-person-document"></a>Editing an existing person document</h3>
<div class="paragraph">
<p>Now, we want to be able to edit an existing person document in my ASP.NET site. First, let&#8217;s add an edit link to each person, by making a change to <code>_person.cshtml</code> partial view.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-HTML" data-lang="HTML">&lt;h2 class="panel-title"&gt;
    @Model.Name
    @Html.ActionLink("[Edit]", "Edit", new {id = Model.Id.Replace("Person::", "")})
    @Html.ActionLink("[Delete]", "Delete", new {id = Model.Id.Replace("Person::", "")}, new { @class="deletePerson"})
&lt;/h2&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>We also added a "delete" link while we were in there, which we&#8217;ll get to later. One more thing to point out: when creating the routeValues, we stripped out "Person::" from <code>Id</code>. If we don&#8217;t do this, ASP.NET will complain about a potentially malicious HTTP request. It would probably be better to give each person a document a more friendly <a href="https://en.wikipedia.org/wiki/Semantic_URL#Slug">"slug"</a> to use in the URL, or maybe to use that as the document key. That&#8217;s going to depend on your use case and your data design.</p>
</div>
<div class="paragraph">
<p>Now we need an <code>Edit</code> action in HomeController:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C#" data-lang="C#">public ActionResult Edit(Guid id)
{
    var person = _personRepo.GetPersonByKey(id);
    return View("Edit", person);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We&#8217;re reusing the same <code>Edit.cshtml</code> view, but now we need to add a hidden field to hold the document ID.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-HTML" data-lang="HTML">&lt;input type="hidden" name="Id" value="@Model.Id"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alright! Now we can add and edit person documents.</p>
</div>
<div class="paragraph">
<p>This may not be terribly impressive to anyone already comfortable with ASP.NET MVC. So, next, let&#8217;s look at something cool that a NoSQL database like Couchbase brings to the table.</p>
</div>
</div>
<div class="sect2">
<h3 id="trueiterating-on-the-data-stored-in-the-person-document"><a class="anchor" href="#trueiterating-on-the-data-stored-in-the-person-document"></a>Iterating on the data stored in the person document</h3>
<div class="paragraph">
<p>A new requirement is that we want to collect more information about a Person. Let&#8217;s say we want to get a phone number, and a list of that person&#8217;s favorite movies. With a relational database, that means that we would need to add <em>at least</em> two columns, and more likely, at least one other table to hold the movies, with a foreign key.</p>
</div>
<div class="paragraph">
<p>With Couchbase, there is no explicit schema. Instead, all we have to do is add a couple more properties to the Person class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C#" data-lang="C#">[DocumentTypeFilter("Person")]
public class Person
{
    public Person() { Type = "Person"; }

    [Key]
    public string Id { get; set; }
    public string Type { get; set; }
    public string Name { get; set; }
    public string Address { get; set; }

    public string PhoneNumber { get; set; }
    public List&lt;string&gt; FavoriteMovies { get; set; }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s pretty much it, except that we also need to add a corresponding UI. I used a bit of jQuery to allow the user to add any number of movies. I won&#8217;t show the code for it here, because the implementation details aren&#8217;t important. But I have made the whole <a href="https://github.com/couchbaselabs/blog-source-code/tree/master/Groves/017MVPBlog/CouchbaseAspNetExample">sample available on Github</a>, so you can follow along or check it out later if you&#8217;d like.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/EditPersonIteration_002.png" alt="Iteration on Person with new UI form"></span></p>
</div>
<div class="paragraph">
<p>We also need to make changes to <code>_person.cshtml</code> to (conditionally) display the extra information:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-HTML" data-lang="HTML">&lt;div class="panel-body"&gt;
    @Model.Address
    @if (!string.IsNullOrEmpty(Model.PhoneNumber))
    {
        &lt;br /&gt;
        @Model.PhoneNumber
    }
    @if (Model.FavoriteMovies != null &amp;&amp; Model.FavoriteMovies.Any())
    {
        &lt;br/&gt;
        &lt;h4&gt;Favorite Movies&lt;/h4&gt;
        &lt;ul&gt;
            @foreach (var movie in Model.FavoriteMovies)
            {
                &lt;li&gt;@movie&lt;/li&gt;
            }
        &lt;/ul&gt;
    }
&lt;/div&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>And here&#8217;s how that would look (this time with two Person documents):</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/IterationDisplayUI_003.png" alt="Iteration on Person with new UI display"></span></p>
</div>
<div class="paragraph">
<p>We didn&#8217;t have to migrate a SQL schema. We didn&#8217;t have to create any sort of foreign key relationship. We didn&#8217;t have to setup any OR/M mappings. We simply added a couple of new fields, and Couchbase turned it into a corresponding JSON document.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/IterationCouchbaseDocument_004.png" alt="Iteration on Person with new JSON document"></span></p>
</div>
</div>
<div class="sect2">
<h3 id="truedeleting-a-person-document"><a class="anchor" href="#truedeleting-a-person-document"></a>Deleting a person document</h3>
<div class="paragraph">
<p>We already added the "Delete" link, so we need to create a new Controller action&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C#" data-lang="C#">public ActionResult Delete(Guid id)
{
    _personRepo.Delete(id);
    return RedirectToAction("Index");
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;and a new repository method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-C#" data-lang="C#">public void Delete(Guid id)
{
    _bucket.Remove("Person::" + id);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that this method is not using Linq2Couchbase. It&#8217;s using the <code>Remove</code> method on <code>IBucket</code>. A <code>Remove</code> method is available on <code>IBucketContext</code>, but we need to pass it an entire document, and not just a key. I elected to use the <code>IBucket</code>, but there&#8217;s nothing inherently superior about it.</p>
</div>
</div>
<div class="sect2">
<h3 id="truewrapping-up"><a class="anchor" href="#truewrapping-up"></a>Wrapping up</h3>
<div class="paragraph">
<p>Thanks for reading through this blog post. Hopefully, you&#8217;re on your way to considering or even including Couchbase in your next ASP.NET project. Here are some more interesting links for you to continue your Couchbase journey:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>There is a <a href="http://blog.couchbase.com/2015/july/the-couchbase-asp.net-identity-storage-provider-part-1">ASP.NET Identity Provider for Couchbase</a> (<a href="https://github.com/couchbaselabs/couchbase-aspnet-identity">github</a>). At the time of this blog post, it&#8217;s an early developer preview, and is missing support for social logins.</p>
</li>
<li>
<p>Linq2Couchbase is a great project with a lot of features and documentation, but it&#8217;s still a work in progress. If you are interested, I suggest visiting <a href="https://github.com/couchbaselabs/Linq2Couchbase">Linq2Couchbase on Github</a>. Ask questions on Gitter, and feel free to submit issues or pull requests.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>I&#8217;ve put the <a href="https://github.com/couchbaselabs/blog-source-code/tree/master/Groves/017MVPBlog/CouchbaseAspNetExample">full source code for this example on Github</a>.</p>
</div>
<div class="paragraph">
<p>What did I leave out? What&#8217;s keeping you from trying Couchbase with ASP.NET today? Please leave a comment, <a href="http://twitter.com/mgroves">ping me on Twitter</a>, or email me (matthew.groves AT couchbase DOT com). I&#8217;d love to hear from you.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2016-07-21 14:42:19 EDT
</div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/styles/github.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
</body>
</html>